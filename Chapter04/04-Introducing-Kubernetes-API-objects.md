# Introducing Kubernetes API Objects

## Getting familiar with the Kubernetes API
### Introducing the API
Cluster admin and engineers interact with K8s cluster through K8s API, which is an HTTP-based RESTful API. Thus, users use the regular HTTP methods like `POST`, `GET`, `PUT/PATCH` or `DELETE` to modify the K8s objects (`pod`, `node`, `deployment` etc,.).

> Note: We can also use the RESTful way to manage a cluster. Please see the Azure doc [here](https://learn.microsoft.com/en-us/rest/api/aks/).

### Understanding the difference between resources and objects

- Resources in RESTful APIs are all associated with URI (uniform resource identifier). For example, `/api/v1/deployments` exposes all the deployments resource in the cluster. Meanwhile, each deployment has its own URI. This means an individual deployment is also exposed as a REST resource.

- In another case, an object can also be exposed via multiple REST resources. For example: 
    - `/apis/apps/v1/deployments` exposed all the deployment;
    - `apis/extensions/v1beta1/deployments` expose all the deployments in another old api.

- Sometimes, a resource doesn't represent any object at all. 
    - `POST` request to `/apis/authorization.k8s.io/v1/subjectaccessreviews` will not change any objects, but to find out the user is authorized or not.

> Note: Resources are more like references, which reference one or more objects. `/apis/apps/v1/deployments` is a reference that refer to a group of deployment objects. Also, each individual deployment can also be referenced by other references. Deployments referenced by different version of K8s Apis.

### Understanding the structure of an object manifest

The following diagram has the best explanation on K8s object manifest. 
![Object Manifest](https://drek4537l1klr.cloudfront.net/luksa3/v-14/Figures/04image004.png)

> Note: Overall, the Kubernetes API is web based or RESTful APIs. Thus, we can talk to the APIs using HTTP/HTTPS. Kubectl provides a way to do this. `kubectl proxy`. With the command, you will have access to the API through the localhost.

### Understanding individual object fields
Using `kubectl explain` to explore API object fields.

- Get the basic description of the object kind using `kubectl explain <kind>`
    - `k explain nodes`
- Check a filed in the object using `kubectl explain <kind>.<field>`
    - `k explain node.spec`
- K8s has different api versions, using `--api-version` to specify the version you want
    - `k explain pods --api-version v1`

### Understanding an object's status conditions

Check the following diagram.
![The status conditions indicating the state of a Node object](https://drek4537l1klr.cloudfront.net/luksa3/v-14/Figures/04image007.png)


## Observing cluster events via Event objects
We can quickly get an overview of the problems a cluster is having by checking the events. Events are generated by Kubernetes controllers, which performs changes on the cluster to make the cluster align with the desired state.Controllers use events to show users what they have done. There are two types of events: 
- Normal
- Warning: the controller was prevented from reconciling the object by something.
An event object will be deleted one hour after its creation.

![The relationship between Event objects, and other API objects](https://drek4537l1klr.cloudfront.net/luksa3/v-14/Figures/04image008.png)

> Note 1: Event is one of the objects in Kubernetes. Thus, we can use command `k get ev` to get all the events. `ev` works as a short name for `events`.

> Note 2: To display additional information, such as first seen and source, you can enable additional columns by using `-o wide` option. `k get ev -o wide`.

### Displaying only warning events
It is useful to see only warning events, as we want to figure out what is the current problem. To acheive this, we can use field selectors. 
- Example: 
  ```bash
  k get ev --field-selector type=Warning
  ```

## TODOs
- [ ] Watch [Azure REST APIs with Postman](https://www.youtube.com/watch?v=6b1J03fDnOg&t=9s)
- [ ] Create a Go project to manage an Azure cluster. 
- [ ] Read [Kubernetes Autherization Overview](https://kubernetes.io/docs/reference/access-authn-authz/authorization/) 
    - Goal: Figure how user autherization works in Kubernetes
- [ ] Read [Kubernetes Taints and Tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/)
- [ ] Read podCIDR [Optimizing IP address allocation](https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr)
